<html>
<head>
  <style>
  body {
    font-family: helvetica,arial;
  }
  </style>
</head>
<body>
  <h1>Chord Tuning Tool</h1>
  <p>Play a chord and tune the intervals</p>
  <P>
    <button onclick="setWave('sine')">Sine</button>
    <button onclick="setWave('sawtooth')">Sawtooth</button>
    <button onclick="setWave('square')">Square</button>
  </p>
  <P>
    <button onclick="switchTo5Limit()">5-Limit</button>
    <button onclick="switchTo3Limit()">3-Limit</button>
    <button onclick="switchTo12Tet()">12-TET</button>
  </p>
  <p>Root: <span id="root"></span></p>
  <p>Third: <span id="third"></span></p>
  <p>Fifth: <span id="fifth"></span></p>
</body>
<script type="text/javascript">

/*
x Play a major triad with web Audio
x Buttons to change tuning of intervals: 12-tet or 5-limit
x Slide to new tuning, dont jump
x choice of waveforms
! Bug: transition not smooth first time
* Display live intervals in cents and ratios
* More tunings
* Custom tuning with sliders
* Minor triad
* Diminished triad
* Dom7
*/

try { if (!AudioContext) { throw 1; } } catch(e) { document.getElementById('body').innerHTML = 'Web Audio not supported!'; }

var audio = new AudioContext();

var playNote = function (f) {
  var vco = audio.createOscillator();
  vco.frequency.value = f;
  vco.type = 'sine';
  var vca = this.audio.createGain();
  vca.gain.value = 0.24;
  vco.connect(vca);
  vca.connect(audio.destination);
  vco.start(0);
  return vco;
};

var generator = 440;

var root = playNote(generator);
var third = playNote(generator*5/4);
var fifth = playNote(generator*3/2);

setInterval(function () {
  document.getElementById('root').innerHTML = root.frequency.value + 'Hz';
  document.getElementById('third').innerHTML = third.frequency.value + 'Hz';
  document.getElementById('fifth').innerHTML = fifth.frequency.value + 'Hz';
}, 100);

switchTo5Limit = function () {
  var t = audio.currentTime + 1;
  third.frequency.linearRampToValueAtTime(generator*5/4, t);
  fifth.frequency.linearRampToValueAtTime(generator*3/2, t);
};

switchTo3Limit = function () {
  var t = audio.currentTime + 1;
  third.frequency.linearRampToValueAtTime(generator*81/64, t);
  fifth.frequency.linearRampToValueAtTime(generator*3/2, t);
};

switchTo12Tet = function () {
  var t = audio.currentTime + 1;
  third.frequency.linearRampToValueAtTime(generator*Math.pow(2, 4/12), t);
  fifth.frequency.linearRampToValueAtTime(generator*Math.pow(2, 7/12), t);
};

setWave = function (type) {
  root.type = type;
  third.type = type;
  fifth.type = type;
};

  </script>
</body>
</html>
