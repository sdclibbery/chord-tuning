<html>
<head>
  <style>
  body {
    font-family: helvetica,arial;
  }
  </style>
</head>
<body>
  <h1>Chord Tuning Tool</h1>
  <p>Play a chord and tune the intervals</p>
  <P>
    <button onclick="setWave('sine')">Sine</button>
    <button onclick="setWave('sawtooth')">Sawtooth</button>
    <button onclick="setWave('square')">Square</button>
  </p>
  <P>
    <button onclick="tuning('5-limit')">5-Limit</button>
    <button onclick="tuning('3-limit')">3-Limit</button>
    <button onclick="tuning('12-tet')">12-TET</button>
  </p>
  <P>
    <button onclick="chord('I')">I</button>
    <button onclick="chord('IV')">IV</button>
    <button onclick="chord('V')">V</button>
    <button onclick="chord('vi')">vi</button>
  </p>
  <p>Root: <span id="root"></span></p>
  <p>Third: <span id="third"></span></p>
  <p>Fifth: <span id="fifth"></span></p>
</body>
<script type="text/javascript">

/*
x Play a major triad with web Audio
x Buttons to change tuning of intervals: 12-tet or 5-limit
x Slide to new tuning, dont jump
x choice of waveforms
* Choice of chords
* More tunings
* Custom tuning with sliders
* Display live intervals in cents and ratios
*/

try { if (!AudioContext) { throw 1; } } catch(e) { document.getElementById('body').innerHTML = 'Web Audio not supported!'; }

var audio = new AudioContext();

var playNote = function (f) {
  var vco = audio.createOscillator();
  vco.frequency.value = f;
  vco.type = 'sine';
  var vca = this.audio.createGain();
  vca.gain.value = 0.24;
  vco.connect(vca);
  vca.connect(audio.destination);
  vco.start(0);
  return vco;
};

var generator = 440;

var root;
var third;
var fifth;

var freqs = {
  I: {
    '5-limit': [ generator, generator*5/4, generator*3/2 ],
    '3-limit': [ generator, generator*3/2*3/2*3/2, generator*3/2 ],
    '12-tet': [ generator, generator*Math.pow(2, 4/12), generator*Math.pow(2, 7/12) ]
  },
  IV: {
    '5-limit': [ generator*4/3, generator*4/3*5/4, generator*4/3*3/2 ],
    '3-limit': [ generator*4/3, generator*4/3*81/64, generator*4/3*3/2 ],
    '12-tet': [ generator*Math.pow(2, 5/12), generator*Math.pow(2, 9/12), generator*Math.pow(2, 12/12) ]
  },
  V: {
    '5-limit': [ generator*3/2, generator*3/2*5/4, generator*3/2*3/2 ],
    '3-limit': [ generator*3/2, generator*3/2*81/64, generator*3/2*3/2 ],
    '12-tet': [ generator*Math.pow(2, 7/12), generator*Math.pow(2, 11/12), generator*Math.pow(2, 14/12) ]
  },
  vi: {
    '5-limit': [ generator*2/3*5/4, generator, generator*5/4 ],
    '3-limit': [ generator*3/2*3/2*3/2/2/2, generator, generator*3/2*3/2*3/2*3/2/2/2 ],
    '12-tet': [ generator*Math.pow(2, -3/12), generator*Math.pow(2, 0/12), generator*Math.pow(2, 4/12) ]
  }
};

var curTuning = '5-limit';
var curChord = 'I';

chord = function (chord) {
  curChord = chord;
  var notes = freqs[curChord][curTuning];
  if (root) { root.stop(); }
  if (third) { third.stop(); }
  if (fifth) { fifth.stop(); }
  root = playNote(notes[0]);
  third = playNote(notes[1]);
  fifth = playNote(notes[2]);
  tuning(curTuning);
};

tuning = function (tuning) {
  curTuning = tuning;
  var t = audio.currentTime + 1;
  var notes = freqs[curChord][curTuning];
  root.frequency.linearRampToValueAtTime(notes[0], t);
  third.frequency.linearRampToValueAtTime(notes[1], t);
  fifth.frequency.linearRampToValueAtTime(notes[2], t);
};

chord(curChord);


setWave = function (type) {
  root.type = type;
  third.type = type;
  fifth.type = type;
};

setInterval(function () {
  document.getElementById('root').innerHTML = root.frequency.value + 'Hz';
  document.getElementById('third').innerHTML = third.frequency.value + 'Hz';
  document.getElementById('fifth').innerHTML = fifth.frequency.value + 'Hz';
}, 100);

  </script>
</body>
</html>
